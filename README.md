# ATLAS

**A**ttention **T**emporal **L**ink **A**nalysis **S**ystem

ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ä¼šè©±åˆ†æã‚·ã‚¹ãƒ†ãƒ  - å­¦ç¿’ãªã—ãƒ»çµ±è¨ˆçš„é‡è¦ç™ºè©±æ¤œå‡º

---

## ğŸ¯ æ¦‚è¦

ATLASã¯ã€ä¼šè©±ä¸­ã®é‡è¦ãªç™ºè©±ã‚’çµ±è¨ˆçš„ã«æ¤œå‡ºã™ã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ†æã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã®è¨“ç·´ã‚’å¿…è¦ã¨ã›ãšã€åŸ‹ã‚è¾¼ã¿ãƒ™ãƒ¼ã‚¹ã®æå¤±è¨ˆç®—ã¨FDRåˆ¶å¾¡ã«ã‚ˆã‚‹å¤šé‡æ¤œå®šè£œæ­£ã§ã€çµ±è¨ˆçš„ã«æœ‰æ„ãªé‡è¦ç™ºè©±ã‚’æŠ½å‡ºã—ã¾ã™ã€‚

### ä¸»ãªç‰¹å¾´

- ğŸ¤ **Web Speech APIçµ±åˆ** - ãƒ–ãƒ©ã‚¦ã‚¶ãƒã‚¤ãƒ†ã‚£ãƒ–ã®éŸ³å£°èªè­˜ï¼ˆç„¡æ–™ï¼‰
- ğŸ“Š **çµ±è¨ˆçš„é‡è¦åº¦æ¤œå‡º** - å¸°ç„¡åˆ†å¸ƒã¨FDRåˆ¶å¾¡ã«ã‚ˆã‚‹å³å¯†ãªæœ‰æ„æ€§åˆ¤å®š
- ğŸ§  **åŸ‹ã‚è¾¼ã¿ãƒ™ãƒ¼ã‚¹åˆ†æ** - OpenAI embeddings + æå¤±é–¢æ•°ã«ã‚ˆã‚‹æƒ…å ±é‡æ¸¬å®š
- âš¡ **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†** - Server Actions + Supabase Realtimeã§å³åº§ã«åˆ†æ
- ğŸ¢ **ãƒ–ãƒ¼ã‚¹åˆ¥ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†** - å®Ÿé¨“ãƒ–ãƒ¼ã‚¹å˜ä½ã§ä¼šè©±ã‚’æ•´ç†
- ğŸ‘¥ **ãƒãƒ«ãƒãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾å¿œ** - è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåŒã˜ä¼šè©±ã«å‚åŠ å¯èƒ½
- ğŸ” **èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ** - Supabaseãƒ™ãƒ¼ã‚¹ã®ãƒ¡ãƒ¼ãƒ«èªè¨¼
- ğŸ“Š **ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰** - ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒ»çµ±è¨ˆè¡¨ç¤ºãƒ»ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- ğŸ”„ **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ** - Supabaseã«ã‚ˆã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿å…±æœ‰
- ğŸ¯ **ã‚¢ãƒ³ã‚«ãƒ¼ãƒ¡ãƒ¢ãƒª** - éå»ã®é‡è¦ç™ºè©±ã‚’é•·æœŸè¨˜æ†¶ã¨ã—ã¦æ´»ç”¨
- ğŸ¨ **ä¾å­˜é–¢ä¿‚å¯è¦–åŒ–** - é‡è¦ç™ºè©±ï¼ˆã‚ªãƒ¬ãƒ³ã‚¸ï¼‰ã¨ä¾å­˜å…ƒï¼ˆç·‘ï¼‰ã®è¦–è¦šçš„è¡¨ç¾

---

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
atlas/
â”œâ”€â”€ apps/
â”‚   â””â”€â”€ web/                             # Next.js 15 ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ (@atlas/web)
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ app/
â”‚       â”‚   â”‚   â”œâ”€â”€ actions/             # Server Actionsï¼ˆæœ€é©åŒ–æ¸ˆã¿ï¼‰
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ analysis.ts     # ä¼šè©±åˆ†æ Server Action
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ session.ts      # ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† Server Actions
â”‚       â”‚   â”‚   â”œâ”€â”€ booth/[booth_id]/   # ãƒ–ãƒ¼ã‚¹åˆ¥ä¼šè©±ç”»é¢
â”‚       â”‚   â”‚   â”œâ”€â”€ debug/              # ãƒ‡ãƒãƒƒã‚°ãƒ“ãƒ¥ãƒ¼ã‚¢
â”‚       â”‚   â”‚   â”œâ”€â”€ sessions/           # ç®¡ç†ï¼šã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§
â”‚       â”‚   â”‚   â””â”€â”€ middleware.ts       # èªè¨¼ãƒ»ç®¡ç†è€…ä¿è­·
â”‚       â”‚   â”œâ”€â”€ features/
â”‚       â”‚   â”‚   â”œâ”€â”€ components/         # UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ ImportantHighlights.tsx  # é‡è¦ç™ºè©±ãƒã‚§ã‚¤ãƒ³ï¼ˆè‰²åˆ†ã‘ï¼‰
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ DependencyMinimap.tsx   # ä¾å­˜é–¢ä¿‚ãƒãƒƒãƒ—
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚       â”‚   â”‚   â””â”€â”€ hooks/              # React hooks
â”‚       â”‚   â”‚       â”œâ”€â”€ useStream.ts    # ãƒ­ãƒ¼ã‚«ãƒ«åˆ†æ
â”‚       â”‚   â”‚       â””â”€â”€ useStreamWithSupabase.ts  # Supabaseçµ±åˆ
â”‚       â”‚   â”œâ”€â”€ hooks/                  # å…±æœ‰hooks
â”‚       â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚       â”‚   â”‚   â””â”€â”€ useSpeechRecognition.ts
â”‚       â”‚   â””â”€â”€ lib/
â”‚       â”‚       â”œâ”€â”€ services/
â”‚       â”‚       â”‚   â””â”€â”€ analysis.ts     # åˆ†æãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”‚       â”‚       â””â”€â”€ supabase/           # Supabase ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚       â”‚           â”œâ”€â”€ client.ts       # ãƒ–ãƒ©ã‚¦ã‚¶ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚       â”‚           â”œâ”€â”€ server-actions.ts  # Server Actionsç”¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚       â”‚           â”œâ”€â”€ service-client.ts  # ã‚µãƒ¼ãƒ“ã‚¹ãƒ­ãƒ¼ãƒ«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆRLSãƒã‚¤ãƒ‘ã‚¹ï¼‰
â”‚       â”‚           â”œâ”€â”€ session.ts      # ã‚»ãƒƒã‚·ãƒ§ãƒ³CRUD
â”‚       â”‚           â””â”€â”€ database.types.ts  # è‡ªå‹•ç”Ÿæˆå‹å®šç¾©
â”‚       â””â”€â”€ package.json
â”‚
â”œâ”€â”€ packages/
â”‚   â””â”€â”€ atlas-core/                     # å…±æœ‰ã‚³ã‚¢ãƒ©ã‚¤ãƒ–ãƒ©ãƒª (@atlas/core)
â”‚       â””â”€â”€ src/
â”‚           â”œâ”€â”€ analyzer/               # ä¼šè©±åˆ†æãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚           â”‚   â”œâ”€â”€ adapters/           # ãƒ¢ãƒ‡ãƒ«ã‚¢ãƒ€ãƒ—ã‚¿ (OpenAI, Fallback)
â”‚           â”‚   â”œâ”€â”€ statistics/         # çµ±è¨ˆé–¢æ•° (FDR, robust, time-decay)
â”‚           â”‚   â”œâ”€â”€ utils/              # æ±ç”¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚           â”‚   â”œâ”€â”€ scoring/            # ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯
â”‚           â”‚   â”œâ”€â”€ analyzer.ts         # ã‚³ã‚¢åˆ†æé–¢æ•°
â”‚           â”‚   â”œâ”€â”€ analyze-with-anchors.ts  # ã‚¢ãƒ³ã‚«ãƒ¼çµ±åˆç‰ˆ
â”‚           â”‚   â”œâ”€â”€ anchor-memory.ts    # é‡è¦ç™ºè©±ã®é•·æœŸè¨˜æ†¶
â”‚           â”‚   â”œâ”€â”€ diversify.ts        # MMRå¤šæ§˜åŒ–
â”‚           â”‚   â”œâ”€â”€ null-samples.ts     # å¸°ç„¡ã‚µãƒ³ãƒ—ãƒ«ç”Ÿæˆ
â”‚           â”‚   â””â”€â”€ types.ts            # Analyzerè¨­å®šå‹
â”‚           â”œâ”€â”€ format/                 # UIç”¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚           â”‚   â””â”€â”€ time.ts             # ç›¸å¯¾æ™‚é–“è¡¨ç¤º
â”‚           â”œâ”€â”€ types.ts                # ã‚³ã‚¢å‹å®šç¾© (Utterance)
â”‚           â””â”€â”€ index.ts                # å…¬é–‹API
â”‚
â””â”€â”€ supabase/
    â””â”€â”€ migrations/                     # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ
        â””â”€â”€ 001_initial_schema.sql      # åˆæœŸã‚¹ã‚­ãƒ¼ãƒ
```

---

## ğŸš€ Getting Started

### Prerequisites

- Node.js >= 18 (æ¨å¥¨: 23.6.1)
- pnpm >= 8
- OpenAI API Key
- Supabase Project (authentication + database + realtime)

### Installation

```bash
# Clone and navigate
cd atlas

# Node.jsãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¨­å®šï¼ˆnvmã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼‰
nvm use

# Install dependencies
pnpm install

# Set up environment variables
cp .env.example .env.local
# Edit .env.local and add:
# - OPENAI_API_KEY=sk-...
# - NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
# - NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJ...
# - SUPABASE_SERVICE_ROLE_KEY=eyJ...  (é‡è¦: ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®ã¿)
# - NEXT_PUBLIC_ADMIN_USERS=admin@example.com
```

### Supabase Setup

1. **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ** - https://supabase.com ã§æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
2. **èªè¨¼è¨­å®š** - Dashboard â†’ Authentication â†’ Settings:
   - Email confirmation: æœ‰åŠ¹ï¼ˆã¾ãŸã¯ç„¡åŠ¹åŒ–ã—ã¦ç°¡ç•¥åŒ–ï¼‰
3. **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ** - SQL Editorã§ä»¥ä¸‹ã‚’é †ç•ªã«å®Ÿè¡Œ:
   ```sql
   -- 001_initial_schema.sql ã®å†…å®¹ã‚’å®Ÿè¡Œ
   ```
4. **ç’°å¢ƒå¤‰æ•°è¨­å®š** - `.env.local`ã«ä»¥ä¸‹ã‚’ã‚³ãƒ”ãƒ¼:
   - `NEXT_PUBLIC_SUPABASE_URL`: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆURL
   - `NEXT_PUBLIC_SUPABASE_ANON_KEY`: å…¬é–‹ã‚­ãƒ¼ï¼ˆanon keyï¼‰
   - `SUPABASE_SERVICE_ROLE_KEY`: ã‚µãƒ¼ãƒ“ã‚¹ãƒ­ãƒ¼ãƒ«ã‚­ãƒ¼ï¼ˆ**æ©Ÿå¯†æƒ…å ±**ï¼‰

### Development

```bash
# Run Next.js dev server with Turbopack
pnpm dev

# Open http://localhost:3000
```

### Build

```bash
# Build for production
pnpm build
```

---

## ğŸ‘¤ ä½¿ã„æ–¹

### 1. **ãƒ­ã‚°ã‚¤ãƒ³** (`/login`)

- ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ï¼ˆ3æ–‡å­—ä»¥ä¸Šã€è‹±æ•°å­—ãƒ»`_`ãƒ»`-`ï¼‰
- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆã¾ãŸã¯ãƒ­ã‚°ã‚¤ãƒ³
- ãƒ–ãƒ¼ã‚¹ä¸€è¦§ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

### 2. **ãƒ–ãƒ¼ã‚¹ä½œæˆ** (`/`)

- ãƒ–ãƒ¼ã‚¹åã‚’å…¥åŠ›ï¼ˆä¾‹: "å®Ÿé¨“A - æ¡ä»¶1"ï¼‰
- ã€Œãƒ–ãƒ¼ã‚¹ã‚’ä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯
- è‡ªå‹•çš„ã«æ–°è¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒä½œæˆã•ã‚Œã‚‹

### 3. **ä¼šè©±** (`/booth/[booth_id]`)

- **éŸ³å£°èªè­˜**: ã€Œé–‹å§‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦éŸ³å£°å…¥åŠ›ã‚’é–‹å§‹
- **ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›**: å…¥åŠ›ãƒœãƒƒã‚¯ã‚¹ã«ç›´æ¥å…¥åŠ›ã—ã¦Enter
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ†æ**:
  - ğŸŸ  **ã‚ªãƒ¬ãƒ³ã‚¸**: æ–°ãŸã«é‡è¦ã¨æ¤œå‡ºã•ã‚ŒãŸç™ºè©±
  - ğŸŸ¢ **ç·‘**: ãã®ä¾å­˜å…ƒã¨ãªã‚‹éå»ã®é‡è¦ç™ºè©±ï¼ˆã‚¢ãƒ³ã‚«ãƒ¼ï¼‰
  - ã‚¹ã‚³ã‚¢ã€på€¤ã€ãƒ©ãƒ³ã‚¯ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º
- **æ“ä½œ**:
  - ã€Œåœæ­¢ã€ã§éŒ²éŸ³ã‚’ä¸€æ™‚åœæ­¢

### 4. **ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰** (`/sessions`) - ç®¡ç†è€…ã®ã¿

- **ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§è¡¨ç¤º**:
  - ãƒ–ãƒ¼ã‚¹åã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å
  - ç™ºè©±æ•°ã€é‡è¦ç™ºè©±æ•°ã€å¹³å‡ã‚¹ã‚³ã‚¢
- **ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ**: JSON/CSVå½¢å¼
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†**:
  - ã€Œâ–¶ã€ã§å±•é–‹ã—ã¦ä¼šè©±å±¥æ­´ã‚’è¡¨ç¤º
  - ã€Œãƒªã‚»ãƒƒãƒˆã€ã§ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢
  - ã€Œå‰Šé™¤ã€ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³å®Œå…¨å‰Šé™¤

### 5. **ãƒ‡ãƒãƒƒã‚°ãƒ“ãƒ¥ãƒ¼ã‚¢** (`/debug?session=xxx`)

- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§åˆ†æçµæœã‚’å¯è¦–åŒ–
- ã‚¹ã‚³ã‚¢è©³ç´°ã€på€¤ã€ãƒ©ãƒ³ã‚¯ã‚’è¡¨ç¤º
- ä¾å­˜é–¢ä¿‚ã‚°ãƒ©ãƒ•ã§é‡è¦ç™ºè©±ã®ã¤ãªãŒã‚Šã‚’è¦–è¦šåŒ–
- URLã§å…±æœ‰å¯èƒ½ï¼ˆä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚‚é–²è¦§å¯ï¼‰

---

## ğŸ“Š Technology Stack

| Layer                  | Technology                             |
| ---------------------- | -------------------------------------- |
| **Frontend**           | Next.js 15 + React 19 + Tailwind CSS  |
| **Backend**            | Next.js Server Actionsï¼ˆæœ€é©åŒ–æ¸ˆã¿ï¼‰  |
| **Authentication**     | Supabase Auth (cookie-based SSR)       |
| **Database**           | PostgreSQL (via Supabase)              |
| **Realtime**           | Supabase Realtime (WebSocket)          |
| **Speech Recognition** | Web Speech API (Browser)               |
| **Embeddings**         | OpenAI text-embedding-3-small          |
| **Hosting**            | Vercel (Serverless + Edge Functions)   |
| **Build System**       | Turborepo + pnpm workspaces            |
| **Code Quality**       | Biome (linter/formatter)               |

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ

- **sessions**: ãƒ–ãƒ¼ã‚¹åˆ¥ä¼šè©±ã‚»ãƒƒã‚·ãƒ§ãƒ³
  - `id` (UUID), `created_at`, `user_id`, `username`, `notes` (ãƒ–ãƒ¼ã‚¹å), `tags`, `experiment_params`
- **utterances**: å€‹åˆ¥ã®ç™ºè©±
  - `id` (BIGSERIAL), `session_id`, `user_id`, `username`, `speaker`, `text`, `timestamp`
- **scores**: ç™ºè©±ã®ã‚¹ã‚³ã‚¢ï¼ˆåˆ†æçµæœï¼‰
  - `id`, `session_id`, `utterance_id`, `score` (JSONB)
  - UNIQUEåˆ¶ç´„: `(session_id, utterance_id)`
- **dependencies**: ä¾å­˜é–¢ä¿‚ã‚¨ãƒƒã‚¸
  - `id`, `session_id`, `from_utterance_id`, `to_utterance_id`
  - UNIQUEåˆ¶ç´„: `(session_id, from_utterance_id, to_utterance_id)`

---

## ğŸ”¬ ã‚³ã‚¢ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

### çµ±è¨ˆçš„é‡è¦ç™ºè©±æ¤œå‡º

ATLASã¯ã€æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã‚’è¨“ç·´ã™ã‚‹ã“ã¨ãªãã€çµ±è¨ˆçš„æ‰‹æ³•ã§é‡è¦ç™ºè©±ã‚’æ¤œå‡ºã—ã¾ã™ã€‚

#### 1. **æå¤±ãƒ™ãƒ¼ã‚¹æƒ…å ±é‡æ¸¬å®š**

å„ç™ºè©±ã®æƒ…å ±é‡ã‚’ã€åŸ‹ã‚è¾¼ã¿ç©ºé–“ã§ã®æå¤±é–¢æ•°ã§æ¸¬å®šï¼š

```
Î”_i = L(Y | H \ {u_i}) - L(Y | H)

L: æå¤±é–¢æ•°ï¼ˆã‚³ã‚µã‚¤ãƒ³é¡ä¼¼åº¦ãƒ™ãƒ¼ã‚¹ï¼‰
H: ä¼šè©±å±¥æ­´
u_i: è©•ä¾¡å¯¾è±¡ã®ç™ºè©±
Y: ç¾åœ¨ã®ç™ºè©±
```

ç™ºè©±ã‚’é™¤ãã¨æå¤±ãŒå¢—åŠ  = ãã®ç™ºè©±ãŒé‡è¦

#### 2. **å¸°ç„¡åˆ†å¸ƒç”Ÿæˆ**

ãƒ©ãƒ³ãƒ€ãƒ ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã§å¸°ç„¡åˆ†å¸ƒã‚’æ§‹ç¯‰ï¼š

```
H_null = shuffle(H)
Î”_null ~ {Î”(H_null, u) | u âˆˆ H_null}
```

#### 3. **på€¤è¨ˆç®—ã¨FDRåˆ¶å¾¡**

- ãƒ­ãƒã‚¹ãƒˆZå¤‰æ›ã§æ­£è¦åŒ–
- çµŒé¨“ç´¯ç©åˆ†å¸ƒé–¢æ•°ï¼ˆECDFï¼‰ã§på€¤ç®—å‡º
- Benjamini-Hochbergæ³•ã§FDRåˆ¶å¾¡ï¼ˆÎ±=0.1ï¼‰

#### 4. **æ™‚é–“æ¸›è¡°**

å¤ã„ç™ºè©±ã»ã©é‡ã¿ã‚’æ¸›è¡°ï¼š

```
w(distance) = exp(-Î» Â· distance)
Î» = ln(2) / halfLifeTurns
```

#### 5. **ã‚¢ãƒ³ã‚«ãƒ¼ãƒ¡ãƒ¢ãƒª**

éå»ã®é‡è¦ç™ºè©±ã‚’é•·æœŸè¨˜æ†¶ã¨ã—ã¦ä¿æŒã—ã€MMRã§å¤šæ§˜æ€§ã‚’ç¢ºä¿ï¼š

```
MMR(u) = Î» Â· relevance(u, current) - (1 - Î») Â· max_similarity(u, selected)
```

### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|-----------|----------|------|
| `k` | 15 | ç›´è¿‘kæ–‡ã‚’å³å¯†è©•ä¾¡ |
| `alphaMix` | 0.6 | æå¤±é‡è¦–åº¦ (0..1) |
| `halfLifeTurns` | 20 | åŠæ¸›æœŸï¼ˆã‚¿ãƒ¼ãƒ³æ•°ï¼‰ |
| `nullSamples` | 20 | å¸°ç„¡ã‚µãƒ³ãƒ—ãƒ«æ•° |
| `fdrAlpha` | 0.1 | FDRé–¾å€¤ |
| `mmrLambda` | 0.7 | MMRé–¢é€£æ€§é‡è¦–åº¦ |

---

## ğŸ¨ UIè¨­è¨ˆ

### è‰²åˆ†ã‘ãƒ«ãƒ¼ãƒ«

- **ğŸŸ  ã‚ªãƒ¬ãƒ³ã‚¸**: æ–°ãŸã«é‡è¦ã¨æ¤œå‡ºã•ã‚ŒãŸç™ºè©±ï¼ˆdependentï¼‰
  - `dependencies.to`ã«å«ã¾ã‚Œã‚‹ç™ºè©±
  - ç¾åœ¨ã®åˆ†æã§é‡è¦ã¨åˆ¤å®šã•ã‚ŒãŸã‚‚ã®
- **ğŸŸ¢ ç·‘**: ä¾å­˜å…ƒã¨ãªã‚‹éå»ã®é‡è¦ç™ºè©±ï¼ˆanchorï¼‰
  - `dependencies.from`ã«å«ã¾ã‚Œã‚‹ç™ºè©±
  - ä»–ã®é‡è¦ç™ºè©±ã‹ã‚‰å‚ç…§ã•ã‚Œã¦ã„ã‚‹åŸºç›¤

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

- **ImportantHighlights**: é‡è¦ç™ºè©±ãƒã‚§ã‚¤ãƒ³ã‚’æ™‚ç³»åˆ—ã§è¡¨ç¤º
- **DependencyMinimap**: ä¾å­˜é–¢ä¿‚ã‚’è¦–è¦šçš„ã«è¡¨ç¤º
- **ConversationStreamWithDependencies**: ç¾åœ¨ã®ç™ºè©±ã‚’è¡¨ç¤º
- **DebugConversationView**: å…¨ç™ºè©±ã«ã‚¹ã‚³ã‚¢ã‚’è¡¨ç¤º

---

---

## ğŸ’° Cost Estimation

| Service                 | Monthly Cost                  |
| ----------------------- | ----------------------------- |
| Vercel Hobby            | $0 (free tier)                |
| Supabase Free Tier      | $0 (500MB DB, 50k auth users, 2GB bandwidth) |
| Web Speech API          | $0 (browser built-in)         |
| OpenAI Embeddings       | ~$0.02/1k texts (1536 dim)    |
| **Total**               | **~$0-10/month** (depending on usage) |

**ä¾‹**: æœˆé–“10,000ç™ºè©± = ç´„$0.20 (embeddings)

---

## ğŸ”§ è¨­å®š

`packages/atlas-core/src/analyzer/types.ts` ã§æ¤œå‡ºãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºï¼š

```typescript
export const defaultOptions: Required<AnalyzerOptions> = {
  k: 15,                  // ç›´è¿‘kæ–‡ã®å³å¯†è©•ä¾¡
  alphaMix: 0.6,          // æå¤±é‡è¦–åº¦ (0..1)
  halfLifeTurns: 20,      // åŠæ¸›æœŸï¼ˆã‚¿ãƒ¼ãƒ³æ•°ï¼‰
  nullSamples: 20,         // å¸°ç„¡ã‚µãƒ³ãƒ—ãƒ«æ•°
  fdrAlpha: 0.1,          // FDRé–¾å€¤
  mmrLambda: 0.7,         // MMRé‡è¦åº¦é‡è¦–åº¦
};
```

### APIä½¿ç”¨ä¾‹

```typescript
import {
  analyzeWithAnchors,
  AnchorMemory,
  OpenAIAdapter
} from '@atlas/core';

// ã‚¢ãƒ€ãƒ—ã‚¿åˆæœŸåŒ–
const adapter = new OpenAIAdapter({ apiKey: 'sk-...' });

// ã‚¢ãƒ³ã‚«ãƒ¼ãƒ¡ãƒ¢ãƒªä»˜ãåˆ†æ
const anchorMemory = new AnchorMemory(200);
const result = await analyzeWithAnchors(
  adapter,
  history,
  current,
  anchorMemory,
  {
    k: 3,
    fdrAlpha: 0.1,
  }
);

// result.important: é‡è¦ç™ºè©±ã®ãƒªã‚¹ãƒˆ
// result.scored: å…¨ç™ºè©±ã®ã‚¹ã‚³ã‚¢
// result.anchorCount: ã‚¢ãƒ³ã‚«ãƒ¼ãƒ¡ãƒ¢ãƒªã®ã‚µã‚¤ã‚º
```

---

## ğŸ“– æŠ€è¡“çš„ç‰¹å¾´

ATLASã®ä¸»ãªæŠ€è¡“çš„é©æ–°ï¼š

1. **å­¦ç¿’ä¸è¦ã®çµ±è¨ˆçš„æ‰‹æ³•** - æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã®è¨“ç·´ãŒä¸è¦
2. **å³å¯†ãªçµ±è¨ˆçš„æ¤œå®š** - å¸°ç„¡åˆ†å¸ƒã¨FDRåˆ¶å¾¡ã«ã‚ˆã‚‹èª¤æ¤œå‡ºæŠ‘åˆ¶
3. **åŸ‹ã‚è¾¼ã¿ãƒ™ãƒ¼ã‚¹æå¤±è¨ˆç®—** - LLMã®åŸ‹ã‚è¾¼ã¿ç©ºé–“ã§æƒ…å ±é‡ã‚’æ¸¬å®š
4. **æ™‚é–“æ¸›è¡°ãƒ¢ãƒ‡ãƒ«** - å¤ã„ç™ºè©±ã®å½±éŸ¿ã‚’æŒ‡æ•°é–¢æ•°çš„ã«æ¸›è¡°
5. **ã‚¢ãƒ³ã‚«ãƒ¼ãƒ¡ãƒ¢ãƒª + MMR** - éå»ã®é‡è¦ç™ºè©±ã‚’å¤šæ§˜æ€§ã‚’ä¿ã¡ãªãŒã‚‰é•·æœŸè¨˜æ†¶
6. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†** - Server Actions + Supabase Realtimeã§å³åº§ã«åˆ†æãƒ»åŒæœŸ
7. **æœ€é©åŒ–ã•ã‚ŒãŸServer Actions** - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã‚’æœ€å°åŒ–
8. **RLSæœ€é©åŒ–** - ã‚µãƒ¼ãƒ“ã‚¹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š

---

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### åˆ†æãŒé…ã„

- **åŸå› **: ä¼šè©±ãŒé•·ããªã‚‹ã¨OpenAI APIå‘¼ã³å‡ºã—ãŒå¢—åŠ 
- **å¯¾ç­–**: `k`ï¼ˆã‚¢ãƒ³ã‚«ãƒ¼æ•°ï¼‰ã‚’æ¸›ã‚‰ã™ã€ã¾ãŸã¯`nullSamples`ã‚’æ¸›ã‚‰ã™

### é‡è¦ç™ºè©±ãŒæ¤œå‡ºã•ã‚Œãªã„

- **åŸå› **: FDRé–¾å€¤ãŒå³ã—ã„ã€ã¾ãŸã¯ä¼šè©±ãŒçŸ­ã„
- **å¯¾ç­–**: `fdrAlpha`ã‚’0.15ã«å¢—ã‚„ã™ã€ã¾ãŸã¯ä¼šè©±ã‚’10ç™ºè©±ä»¥ä¸Šç¶šã‘ã‚‹

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼

- **åŸå› **: RLSãƒãƒªã‚·ãƒ¼ã¾ãŸã¯ç’°å¢ƒå¤‰æ•°ã®å•é¡Œ
- **å¯¾ç­–**:
  1. `002_fix_rls_policies.sql`ã‚’å®Ÿè¡Œ
  2. `SUPABASE_SERVICE_ROLE_KEY`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
  3. Supabaseãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ãƒ†ãƒ¼ãƒ–ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

---

## ğŸ“ License

MIT

---

## ğŸ™ Acknowledgments

- Original concept inspired by conversation analysis research
- Built with Next.js 15, React 19, OpenAI, Supabase, and Vercel
- Web Speech API by W3C/Chrome team
